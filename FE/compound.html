<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Compound Interest — Fintech & PySpark Portfolio</title>
    <link rel="stylesheet" href="styles.css" />
</head>

<body>
    <header class="container header">
        <a href="/" class="logo">← Home</a>
        <nav>
            <a href="/#projects">Projects</a>
            <a href="/#about">About</a>
            <a href="/#contact">Contact</a>
        </nav>
    </header>

    <main class="container" id="compoundApp">
        <section class="about">
            <h2>Compound Interest Calculator</h2>
            <form id="ciForm">
                <div class="row"><label>Principal<input name="principal" type="number" step="0.01" value="1000"
                            required></label></div>
                <div class="row"><label>Annual Interest Rate (%)<input name="rate_pct" type="number" step="0.0001"
                            value="5" required></label></div>
                <div class="row"><label>Years<input name="years" type="number" step="0.1" value="10" required></label>
                </div>
                <div class="row"><label>Compounds per Year<input name="compounds_per_year" type="number" value="12"
                            required></label></div>
                <div class="row"><label>Recurring Contribution per Period<input name="contribution" type="number"
                            step="0.01" value="100" required></label></div>
                <button type="submit">Calculate</button>
                <small id="ciStatus" class="muted"></small>
            </form>

            <div id="ciResults" class="article" style="display:none">
                <h3>Results</h3>
                <ul class="metrics" id="ciSummary"></ul>
                <div id="ciMiniChart" class="muted" style="margin-top:10px"></div>
            </div>
            <div id="ciChartWrap" style="margin-top:20px;display:none">
                <h3>Growth Chart</h3>
                <img id="ciChart" style="max-width:100%;border:1px solid #e5e7eb;border-radius:12px" />
            </div>

        </section>
    </main>

    <footer class="container footer"><small>© <span id="y"></span> [Your Name]</small></footer>

    <!-- Reuse same API base as the site -->
    <script>window.API_BASE = "https://fintech-portfolio-546985714630.europe-west1.run.app";</script>
    <script>
        document.getElementById('y').textContent = new Date().getFullYear();

        // Lightweight page script (kept here to avoid touching app.js)
        const form = document.getElementById('ciForm');
        const statusEl = document.getElementById('ciStatus');
        const resultsWrap = document.getElementById('ciResults');
        const summaryEl = document.getElementById('ciSummary');
        const miniChart = document.getElementById('ciMiniChart');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            statusEl.textContent = 'Calculating…';
            resultsWrap.style.display = 'none';
            summaryEl.innerHTML = '';
            miniChart.innerHTML = '';

            const data = Object.fromEntries(new FormData(form).entries());
            // cast numeric fields
            ['principal', 'rate_pct', 'years', 'compounds_per_year', 'contribution'].forEach(k => data[k] = Number(data[k]));

            try {
                const res = await fetch(`${window.API_BASE}/api/finance/compound`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (!res.ok) throw new Error('Request failed');
                const out = await res.json();


                const chartWrap = document.getElementById('ciChartWrap');
                const chartImg = document.getElementById('ciChart');
                window.scroll({
                    bottom: 100,
                    behavior: "smooth",
                });
                const resImg = await fetch(`${window.API_BASE}/api/finance/compound/plot`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (resImg.ok) {
                    const blob = await resImg.blob();
                    chartImg.src = URL.createObjectURL(blob);
                    chartWrap.style.display = '';

                    // Scroll smoothly to the chart
                    chartWrap.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }

                // Summary
                const fmt = x => Number(x).toLocaleString(undefined, { maximumFractionDigits: 2 });
                summaryEl.innerHTML = `
          <li><strong>Future Value:</strong> €${fmt(out.final_value)}</li>
          <li><strong>Principal:</strong> €${fmt(out.principal)}</li>
          <li><strong>Contributions:</strong> €${fmt(out.total_contributions)}</li>
          <li><strong>Compound Interest:</strong> €${fmt(out.total_interest)}</li>
        `;
                resultsWrap.style.display = '';

                // Tiny ASCII sparkline for balance (keeps things dependency-free)
                const pts = out.points;
                if (pts.length > 2) {
                    const sample = pts.filter((_, i) => i % Math.max(1, Math.floor(pts.length / 40)) === 0);
                    const max = Math.max(...sample.map(p => p.balance));

                }
                statusEl.textContent = '';
            } catch (err) {
                statusEl.textContent = 'Error. Please check inputs and try again.';
            }


        });
    </script>
</body>

</html>